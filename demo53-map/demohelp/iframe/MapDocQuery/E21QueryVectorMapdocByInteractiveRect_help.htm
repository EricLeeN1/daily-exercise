<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
    <title>矢量地图文档查询服务(交互式矩形查询)</title>
    <link href="../../css/helpstyle.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <div class="biaoti">
        矢量地图文档查询服务(交互式矩形查询):
    </div>
    <br />
    <div class="xiaobiaoti">
        一、示例功能：
    </div>
    <div class="zhengwen">
        该示例实现矩形查询矢量地图文档，高亮显示结果要素的功能。
    </div>
    <div class="xiaobiaoti">
        二、实现说明：
    </div>
    <div class="zhengwen">
        1、数据：使用世界地图的矢量地图文档（WorldJWVector.mapx），该矢量数据服务在GIS服务器中发布。<br />
        <br />
        2、实现步骤：
        <br />
        <br />
        [地图显示]
        <br />
        <br />
        （1）先引入OpenLayers.js（OpenLayers是一个专为Web GIS 客户端开发提供的JavaScript 类库包，用于实现标准格式发布的地图数据访问。）、jquery-1.11.2.min.js（第三方js资源库）、zdclient.js(中地公司提供的一套基于OpenLayers的MapGISWeb二次开发的脚本库)；
        <br />
        <br />
        （2）再创建一个ID为“mapCon”的div层，并设置其样式；
        <br />
        <br />
        （3）然后编写调用矢量地图文档显示的脚本函数init()，即初始化OpenLayers.Map与Zondy.Map.Doc类，以及用于高亮显示结果的图层类OpenLayers.Layer.Vector，通过Map对象的addLayers方法加载Doc对象，并由Map对象的setCenter方法设置初始化地图的中心点与显示级别，加载世界地图。
        <br />
        <br />
        （4）最后初始化查询结构对象Zondy.Service.QueryFeatureStruct，设置查询结构包含几何信息；指定一个查询的规则Zondy.Service.QueryFeatureRule；绘制一个用于查询的矩形；实例化查询参数对象Zondy.Service.QueryParameter，设置查询要素数目、用于查询的几何描述geometry；实例化地图文档查询服务对象Zondy.Service.QueryDocFeature，并调用QueryDocFeature对象的query方法，执行查询。
        <br />
        <br />
        （5）在查询结果回调函数中初始化Zondy.Format.PolygonJSON类，调用该类的read方法，获取查询结果中的features，然后调用结果矢量图层的addFeatures方法将要素添加到结果图层并高亮显示。
        <br />
        <br />
        [添加地图控件]
        <br />
        <br />
        （6）添加放大缩放导航控件OpenLayers.Control.Zoom()或OpenLayers.Control.PanZoomBar()。
        <br />
        <br />
        （7）添加图层切换控件OpenLayers.Control.LayerSwitcher；
        <br />
        <br />
        （8）添加地图浏览控件OpenLayers.Control.Navigation()；
        <br />
        <br />
        （9）添加鼠标位置控件OpenLayers.Control.MousePosition()。
        <br />
    </div>
    <div class="xiaobiaoti">
        三、功能类/参数说明
    </div>
    <div class="zhengwen">
        <font class="Class">1、OpenLayers.Map类： </font>该类是一个地图容器类<br />
        <br />
        <font class="constructorTile">1.1 构造函数：</font>
        <br />
        <div class="zhuji">
            <font class="constructor">OpenLayers.Map(div,options)</font><br />
            <br />
            <font class="paraDescription">参数说明：</font>
            <br />
            <font class="parameter">div：</font>（String类型）必选项，地图所在的网页div元素的id，例如代码中的'mapCon'。等同于：{div:'mapCon'}；<br />
            <font class="parameter">options：</font>（Object类型）可选项，设置该对象其他属性，以键值对的形式设置。<br />
            <font class="nextParameter">【1】isAutoConfig：</font>（Boolean类型）可选项，是否自动获取地图配置参数（即maxExtent、MaxResolution、numZoomLevels等），默认为true即自动获取。若要自定义上述参数项，可设置其为false；<br />
            <font class="nextParameter">【2】controls：</font>（Array类型-[OpenLayers.Control]）可选项，加载的地图相关控件，但是如果controls后的数组为空的话，作用是清除map容器中的默认控件，例如代码中的：controls:[]；
        </div>
        <font class="funDescription">1.2方法说明：</font><br />
        <div class="zhuji">
            <font class="functionName">addLayers([layers])：</font>添加多个图层到地图容器中。详细参数介绍如下：<br />
            <font class="nextParameter">layers：</font>（Array类型-[OpenLayers.Layer]）继承于OpenLayers.Layer的图层对象。<br />
            <br />
            <font class="functionName">setCenter(lonlat,zoom)：</font>设置地图的显示中心和显示级别，初始加载地图调用此方法是为了渲染显示地图。详细参数介绍如下：<br />
            <font class="nextParameter">lonlat：</font>（OpenLayers.LonLat类型）描述地图位置的对象。<br />
            <font class="nextParameter">zoom：</font>（int类型）地图的显示级数。<br />
        </div>
        <font class="Class">2、OpenLayers.Control.Zoom类：</font>底图放大缩放导航控件，在左上角角显示，用来放大缩小图层，也可以写成OpenLayers.Control.PanZoomBar。<br />
        <br />
        <font class="Class">3、OpenLayers.Control.LayerSwitcher类：</font>图层切换控件，在右上角显示，可以进行图层切换。<br />
        <br />
        <font class="Class">4、OpenLayers.Control.Navigation类：</font>地图导航控件，用来实现鼠标滚轮对地图进行放大缩小操作以及鼠标移动地图等功能。<br />
        <br />
        <font class="Class">5、OpenLayers.Control.MousePosition类：</font>鼠标位置控件，在右下角显示。<br />
        <br />
        <font class="Class">6、Zondy.Map.Doc类：</font>该类是一个提供显示矢量地图文档的功能服务类<br />
        <br />
        <div class="zhuji">
            <font class="constructor">Zondy.Map.Doc(name,docName,options)</font><br />
            <br />
            <font class="paraDescription">参数说明：</font>
            <br />
            <font class="parameter">name：</font>（String类型）必填项，设置显示图层的名称（可自行设置名称）；<br />
            <font class="parameter">docName：</font>（String类型）必填项，设置地图文档文件的名称（根据IGServer上发布的实际名称）；<br />
            <font class="parameter">options：</font>（Object类型）可选项，设置其他属性赋值对象，以键值对的形式设置；<br />
            <font class="nextParameter">【1】ip：</font>（String类型）可选项，来源于父类（Zondy.Service.HttpRequest）参数，服务器地址ip，默认值："localhost"；<br />
            <font class="nextParameter">【2】port：</font>（String类型）可选项，来源于父类（Zondy.Service.HttpRequest）参数，服务器端口，默认值："6163"；<br />
            <font class="nextParameter">【3】isBaseLayer：</font>（Boolean类型）可选项，是否作为基础图层显示，默认值：true。
        </div>
        <font class="Class">7、OpenLayers.Layer.Vector类：</font>该类是一个矢量图层类<br />
        <br />
        <font class="constructorTile">7.1 构造函数：</font>
        <br />
        <div class="zhuji">
            <font class="constructor">OpenLayers.Layer.Vector(name,options)</font><br />
            <br />
            <font class="paraDescription">参数说明：</font>
            <br />
            <font class="parameter">name：</font>（String类型）第一个参数，必选项，设置显示图层的名称。<br />
            <font class="parameter">options：</font>（Object类型）可选项，设置该对象其他属性，以键值对的形式设置。<br />
        </div>
        <font class="funDescription">7.2方法说明：</font><br />
        <div class="zhuji">
            <font class="functionName">addFeatures(features,options)：</font>添加要素方法，将矢量要素添加到图层中。<br />
            <font class="nextParameter">features：</font>（Array数组类型-[OpenLayers.Feature.Vector])，必选项，指定该图层中要添加的要素。<br />
            <font class="nextParameter">options：</font>（Object类型）可选项，添加该对象其他属性。
            <br />
            <br />
            <font class="functionName">setVisibility(visibility)：</font>设置图层的显示和隐藏（该方法继承于OpenLayers.Layer）。<br />
            <font class="nextParameter">visibility：</font>（Boolean类型），设置图层的显示和隐藏。<br />
        </div>
        <font style="font-weight: bold;">8、OpenLayers.Control.DrawFeature类：</font>绘图控件<br />
        <br />
        <font class="constructorTile">8.1 构造函数：</font>
        <br />
        <div class="zhuji">
            <font class="constructor">OpenLayers.Control.DrawFeature(layer, handler, options)</font><br />
            <br />
            <font class="paraDescription">参数说明：</font>
            <br />
            <font class="parameter">layer：</font>（OpenLayers.Layer.Vector类型）必选项，绘制的图形将被添加到该图层。<br />
            <font class="parameter">handler：</font>（OpenLayers.Handler类型）必选项，指定绘制的图形类型。<br />
            <font class="parameter">options：</font>（object类型）可选项，设置该绘图控件的配置选项。
        </div>
        <font class="funDescription">8.2 方法说明：</font>
        <br />
        <div class="zhuji">
            <font class="functionName">activate()：</font>激活绘图控件的方法；<br />
            <br />
            <font class="functionName">deactivate()：</font>关闭绘图控件的方法。
        </div>
        <font class="attribute">8.3 公共属性</font>
        <br />
        <div class="zhuji">
            <font class="parameter">featureAdded:</font>（Function类型）可选项，用来设置绘制的回调函数。
        </div>
        <font class="Class">9、OpenLayers.Handler.RegularPolygon类：</font>该类是一个绘制规则多边形的处理程序类，继承于OpenLayers.Handler.Drag类，而OpenLayers.Handler.Drag继承于OpenLayers.Handler类<br />
        <br />
        <font class="funDescription">9.1 方法说明：</font>
        <br />
        <div class="zhuji">
            <font class="functionName">setOptions(newOptions)：</font>重新设置OpenLayers.Handler.RegularPolygon对象的公共属性，详细介绍如下所示：<br />
            <font class="nextParameter">newOptions:</font>（object类型）一些重新设置过的OpenLayers.Handler.RegularPolygon对象的公共属性。如下所示：<br />
            【1】sides:（整型）sides的值最小可以取1，但是需要注意的是：sides：1绘制的只是一个点；sides：2的时候绘制的是一条直线；sides的取值大于3之后才绘制规则多边形，sides的取值越大，规则多边形的边数就越多，绘制的规则多变形就越接近圆。<br />
            【2】snapAngle:（整型）如果设置为非零值,图形将旋转至给定的值，该值的角度计算是从正轴逆时针开始计算的。具体效果参见示例代码。<br />
            【3】irregular:（Boolean类型）画一个不规则的多边形代替正多边形。默认是false。如果这是true,最初的鼠标将代表多边形边界的一个角落和每一个鼠标移动,多边形会跟随鼠标的位置向相反的方向绘制。这个属性优先于半径属性。如果设置为true,那么半径属性将被忽略。
        </div>
        <font class="Class">10、Zondy.Service.QueryFeatureStruct类：</font>该类是指定查询获取的要素包含的信息结构<br />
        <br />
        <font class="constructorTile">10.1 构造函数：</font>
        <br />
        <div class="zhuji">
            <font class="constructor">Zondy.Service.QueryFeatureStruct(options)</font><br />
            <br />
            <font class="paraDescription">参数说明：</font>
            <br />
            <font class="parameter">options：</font>（Object类型）可选项，设置该对象其他属性，以键值对的形式设置。<br />
            <font class="nextParameter">【1】IncludeAttribute：</font>（Boolean类型）是否包含属性值，默认值是true；<br />
            <font class="nextParameter">【2】IncludeGeometry：</font>（Boolean类型）是否包含几何图形信息，默认值是false；<br />
            <font class="nextParameter">【3】IncludeWebGraphic：</font>（Boolean类型）是否包含图形参数，默认值是false；<br />
        </div>
        <font class="Class">11、Zondy.Object.Rectangle类：</font>MapGIS对象类，描述一个矩形形状<br />
        <br />
        <font class="constructorTile">11.1 构造函数：</font>
        <br />
        <div class="zhuji">
            <font class="constructor">Zondy.Object.Rectangle(argument1,argument2,argument3,argument4)</font><br />
            <br />
            <font class="paraDescription">参数说明：</font>
            <br />
            <font class="parameter">xmin：</font>（Float类型）必填项，构造函数的第一个参数，表示矩形的x轴坐标最小值，默认值0.0；<br />
            <font class="parameter">xmax：</font>（Float类型）必填项，构造函数的第二个参数，表示矩形的y轴坐标最小值，默认值0.0；<br />
            <font class="parameter">ymin：</font>（Float类型）必填项，构造函数的第三个参数，表示矩形的X轴坐标最大值，默认值0.0；<br />
            <font class="parameter">ymax：</font>（Float类型）必填项，构造函数的第四个参数，表示矩形的Y轴坐标最大值，默认值0.0。
        </div>
        <font class="funDescription">11.2方法说明：</font><br />
        <div class="zhuji">
            <font class="functionName">setByOL(openlayersRect)：</font>设置矩形形状几何信息<br />
            <font class="nextParameter">openlayersRect：</font>（OpenLayers.Geometry类型），由OpenLayers定义的矩形对象
            <br />
            <br />
            <font class="functionName">toString()：</font>获取代表当前矩形形状的字符串；
            <br />
            <br />
            <font class="functionName">convertToBound()：</font>（OpenLayers.Bound类型）将Zondy.Object.Rectangle类型对象转换为OpenLayers.Bound类型对象的方法。
            <br />
        </div>
        <font class="Class">12、Zondy.Service.QueryParameter类：</font>该类是描述基于矢量地图文档的查询参数<br />
        <br />
        <font class="constructorTile">12.1 构造函数：</font>
        <br />
        <div class="zhuji">
            <font class="constructor">Zondy.Service.QueryParameter(options)</font><br />
            <br />
            <font class="paraDescription">参数说明：</font>
            <br />
            <font class="parameter">options：</font>（Object类型）可选项，设置该对象其他属性，以键值对的形式设置。<br />
            <font class="nextParameter">【1】geometry：</font>（Zondy.Object.Tangram类对象）用于查询的几何描述（若为属性条件查询，此参数为空；若为空间范围查询或组合查询时，此参数为必选参数）。来自其父类（Zondy.Service.QueryParameterBase）的属性；<br />
            <font class="nextParameter">【2】where：</font>（String类型）可选项，条件查询的SQL语句（如果为空，则表示为单一的几何查询；如果取值，表示为属性条件查询或几何和条件混合查询）。来自其父类（Zondy.Service.QueryParameterBase）的属性；<br />
            <font class="nextParameter">【3】rule：</font>（Zondy.Service.QueryFeatureRule类对象）指定几何查询的规则。来自其父类（Zondy.Service.QueryParameterBase）的属性；<br />
            <font class="nextParameter">【4】objectIds：</font>（String类型）可选项，需要查询的要素OID号，多个间用‘，’分隔（如果此参数有值，查询将默认转化为使用要素ID查询，Where、geometry、geometryType等查询参数无效）。来自其父类（Zondy.Service.QueryParameterBase）的属性；<br />
            每个要素的ObjectID值可通过MapGIS工作空间（MapWorkSpace）获取，在GDBCatalog目录树中，右键图层选择“预览”，在“内容视窗”中选择“图属信息”，可查询图层所有要素的空间与属性信息，属性信息中OID则为要素的objectId的值。<br />
            <font class="nextParameter">【5】pageIndex：</font>（Int类型）可选项，分页号，默认值为0。来自其父类（Zondy.Service.QueryParameterBase）的属性；<br />
            <font class="nextParameter">【6】recordNumber：</font>（Int类型）可选项，每页记录数，默认值为20。来自其父类（Zondy.Service.QueryParameterBase）的属性；<br />
            <font class="nextParameter">【7】resultFormat：</font>（String类型）可选项，查询结果的序列化形式，默认值是json(对于xml，kml，gml或者georss格式的类xml类型将以text文本返回，如需要可调用$.parseXML(text)得到其xml包装)。来自其父类（Zondy.Service.QueryParameterBase）的属性；<br />
            <font class="nextParameter">【8】struct：</font>（Zondy.Service.QueryFeatureStruct类对象）必填项，指定查询返回结果所包含的要素信息。来自其父类（Zondy.Service.QueryParameterBase）的属性；<br />
        </div>
        <font class="Class">13、Zondy.Service.QueryFeatureRule类：</font>该类是指定几何查询的规则<br />
        <br />
        <font class="constructorTile">13.1 构造函数：</font>
        <br />
        <div class="zhuji">
            <font class="constructor">Zondy.Service.QueryFeatureRule(options)</font><br />
            <br />
            <font class="paraDescription">参数说明：</font>
            <br />
            <font class="parameter">options：</font>（Object类型）可选项，设置该对象其他属性，以键值对的形式设置。<br />
            <font class="nextParameter">【1】MustInside：</font>（Boolean类型）可选项，表示是否完全包含（true| false（默认值））。当MustInside设为true时，其他查询规则无效；当MustInside设为false时Intersect和CompareRectOnly才生效；<br />
            <font class="nextParameter">【2】Intersect：</font>（Boolean类型）可选项，表示是否相交（true| false（默认值））。点几何查询时Intersect只能设为true；其他几何查询（线查询、多边形、圆查询等）时Intersect可设置true和false；<br />
            <font class="nextParameter">【3】CompareRectOnly：</font>（Boolean类型）可选项，表示是否仅比较要素的外包矩形，来判定是否与几何约束图形有交集（true|
            false（默认值））。只有当Intersect只能设为true时，此项才能进行设置；<br />
            <font class="nextParameter">【4】EnableDisplayCondition：</font>（Boolean类型）可选项，表示是否将要素的可见性计算在内（true|
            false（默认值））。此查询规则以失效，只做兼容性保留。
        </div>
        <font class="Class">14、Zondy.Service.QueryDocFeature类：</font>该类是提供基于矢量地图文档的查询服务<br />
        <br />
        <font class="constructorTile">14.1 构造函数：</font>
        <br />
        <div class="zhuji">
            <font class="constructor">Zondy.Service.QueryDocFeature(queryParam,docName,layerIndex,options)</font><br />
            <br />
            <font class="paraDescription">参数说明：</font>
            <br />
            <font class="parameter">queryParam：</font>（Zondy.Service.QueryParameter类对象）必填项，查询参数信息；<br />
            <font class="parameter">docName：</font>（String类型）必填项，地图文档名称(根据IGServer上发布的实际名称)；<br />
            <font class="parameter">layerIndex：</font>（Int类型）必填项，图层序号，默认值0；<br />
            <font class="parameter">options：</font>（Object类型）可选项，设置该对象其他属性，以键值对的形式设置。<br />
            <font class="nextParameter">【1】ip：</font>（String类型）options中的项，来源于父类（Zondy.Service.HttpRequest）参数，IGServer服务器ip，默认值："localhost"；<br />
            <font class="nextParameter">【2】port：</font>（String类型）options中的项，来源于父类（Zondy.Service.HttpRequest）参数，IGServer服务端口，默认值："6163"；
        </div>
        <font class="funDescription">14.2方法说明：</font><br />
        <div class="zhuji">
            <font class="functionName">query(onSuccess,onError,requestType)：</font>查询函数，向服务器发送请求（来源于父类Zondy.Service.QueryServiceBase中的方法）<br />
            <font class="nextParameter">onSuccess：</font>（Function类型）请求成功时回调函数<br />
            <font class="nextParameter">onError：</font>（Function类型）请求失败时回调函数<br />
            <font class="nextParameter">requestType：</font>：（String类型）请求方式（GET或者POST）。如果没有设置此项时，默认使用GET方式请求。
        </div>
    </div>
    <p>
        <a href="http://simayun.cn:81/API/JS/JavaScript_API(OL2)/default.html" alt="MapGIS IGServer JavaScript Client的API手册。"
            target="_blank">注：详细说明请参见MapGIS IGServer JavaScript Client的API手册。</a>
    </p>
</body>
</html>
