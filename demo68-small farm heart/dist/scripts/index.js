"use strict";$(function(){jQuery.support.cors=!0;var r=window.Base||{};(r={site:"http://47.92.146.91:8089",site2:"http://60.205.111.27:807",default:"",shareData:{title:"孤独招领处",subTitle:"来孤独招领处--释放你内心里那些无法对人言语的东西吧！"},replyHtml:'<div class="reply-area"><textarea maxlength="140" name="reply-content" id="reply-content"></textarea><div id="btn-reply">回复</div></div>',handShake:function(i,e){var o=this,n=o.getQueryString(i),s=o.getQueryString(e);o.id=n,console.log(n,s),o.type=s,""==n||""==s?window.location.href="404.html":$.ajax({type:"POST",url:r.site+"/WebService.asmx/AcquireSecretKey",data:{type:3,ts:Date.parse(new Date)/1e3},dataType:"json",success:function(e){if(1==e.msgcode){var t=CryptoJS.enc.Latin1.parse("l@j#g=c!w*)8(^5$"),a=CryptoJS.enc.Latin1.parse("L+*df5,Ir)b$=pkf");e.data.key=CryptoJS.AES.decrypt(e.data.key,t,{iv:a,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Utf8),e.data.secret=CryptoJS.AES.decrypt(e.data.secret,t,{iv:a,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Utf8),sessionStorage.setItem("handShake",JSON.stringify(e)),n&&s&&(1==s?(o.getDetail(i),setTimeout(function(){o.getList(i)},1e3)):(console.log("11111"),$("#vote-gifts-btn-group").show(),o.getDetail1(i),setTimeout(function(){o.getList1(i)},1e3)))}else alert("服务器连接错误")}})},getInitData:function(e,t){var a=this,i=a.getQueryString(e),o=a.getQueryString(t);a.id=i,a.type=o,console.log(i,o),i&&o?1==o?(a.getDetail(e),setTimeout(function(){a.getList(e)},1e3)):($("#vote-gifts-btn-group").show(),a.getDetail1(e),setTimeout(function(){a.getList1(e)},1e3)):window.location.href="404.html"},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(t),i="";return null!=a&&(i=a[2]),(a=t=null)==i||""==i||"undefined"==i?"":i},objKeySort:function(e){for(var t=Object.keys(e).sort(),a={},i=0;i<t.length;i++)a[t[i]]=e[t[i]];return a},getAjax:function(e,t,a){JSON.parse(sessionStorage.getItem("handShake"));var i={};for(var o in t)i[o]=t[o];i.ts=Date.parse(new Date)/1e3-0+JSON.parse(sessionStorage.getItem("handShake")).data.ts,i.key=JSON.parse(sessionStorage.getItem("handShake")).data.key;var n={};for(var o in i)n[o]=i[o];n.sec=JSON.parse(sessionStorage.getItem("handShake")).data.secret,$.ajax({type:"get",url:""+this.site+e+$.param(i,!0)+"&sign="+_md5($.param(this.objKeySort(n),!0)),dataType:"json",success:a})},postAjax:function(e,t,a){$.ajax({type:"post",url:this.site+e,data:t,dataType:"json",success:a})},getDetail:function(e){var i=this,t=i.getQueryString(e);t?i.postAjax("/api/common/good/goodInfo",{id:t},function(t){if(console.log(t),1==t.msgcode){if(i.Info=t.data,$("#music").attr("src",i.site2+i.Info.musicpath),$("#app>header.mirror-2").removeClass("mirror-2").addClass("mirror-"+i.Info.scene),$("#app>header").css("background-color","#"+i.Info.skin),$("#music")[0].play(),$("#user-infos-group img:eq(0)").attr("src",i.site2+t.data.ulogo),$("#shower-logo").attr("src",i.site2+t.data.logo),$("#user-infos-group>.user-infos>h5").html(t.data.uname).next().html(t.data.ptime),1==t.data.facenumber)$("#heart-single-group>.heart:eq(0)").html("<p>"+t.data.smile+"</p>").next().html("<p>"+t.data.lefteye+"</p>").next().html("<p>"+t.data.age+"</p>").next().html("<p>"+t.data.mouth+"</p>").next().html("<p>"+t.data.righteye+"</p>").next().html("<p>"+t.data.emotion+"</p>").next().html(t.data.gender),$(".stamp-front>h3").html(t.data.score),$(".envelope-comments").html(t.data.comment);else if($("#heart-single-group>.heart-many").html(t.data.facecomment).css("bottom","-.2rem"),browser.versions.mobile){var a=document.documentElement.clientWidth;i.getImgInfos(i.site2+t.data.logo),setTimeout(function(){var e=i.imgInfo.width/a;i.setFaceBorder(t,e)},2e3)}else i.getImgInfos(i.site2+t.data.logo),setTimeout(function(){var e=i.imgInfo.width/750;i.setFaceBorder(t,e)},2e3);$("#user .user-judge").html(0<t.data.comment.length?t.data.comment:"这位少年，骨骼惊奇，将来必有大成就！")}else alert(t.msg)}):window.location.href="/404.html"},setFaceBorder:function(e,t){this.imgInfo.height,this.imgInfo.width;e.data.facerectangle.top=e.data.facerectangle.top/t,e.data.facerectangle.left=e.data.facerectangle.left/t,e.data.facerectangle.width=e.data.facerectangle.width/t,e.data.facerectangle.height=e.data.facerectangle.height/t,$("#banner>.face-border").show().css({width:e.data.facerectangle.width,height:e.data.facerectangle.height,top:e.data.facerectangle.top,left:e.data.facerectangle.left})},getImgInfos:function(e){(new Date).getTime();var t=this,a=e,i=new Image;i.src=a;var o=setInterval(function(){(0<i.width||0<i.height)&&((new Date).getTime(),clearInterval(o))},40);i.onload=function(){var e={width:i.width,height:i.height};t.imgInfo=e}},getDetail1:function(e){var t=this,a=t.getQueryString(e);a?t.postAjax("/FrontendService.asmx/AppearanceLevelDetail?",{id:a},function(e){1==e.msgcode?(e.data.musicpath&&"/music/BillboardMusic/"!=e.data.musicpath||(e.data.musicpath="/music/BillboardMusic/20180118030.mp3"),e.data.scene||(e.data.scene="2"),e.data.skin||(e.data.skin="ff5053"),t.Info=e.data,$("#music").attr("src",t.site2+t.Info.musicpath),$("#app>header.mirror-2").removeClass("mirror-2").addClass("mirror-"+t.Info.scene),$("#app>header").css("background-color","#"+t.Info.skin),$("#music")[0].play(),$("header.mirror").css("height","13rem"),console.log(e.data.status),1==e.data.status?$("#vote-gifts-btn-group>vote-gifts-btn:eq(1)").show():3==e.data.status?$("#vote-gifts-btn-group>.vote-gifts-btn:eq(2)").show():e.data.isvote?$("#vote-gifts-btn-group>.vote-gifts-btn:eq(3)").show():$("#vote-gifts-btn-group>.vote-gifts-btn:eq(0)").show(),$("#reply-form-main").css("top","-.4rem"),$("#user-infos-group img:eq(0)").attr("src",t.site2+e.data.ulogo),$("#shower-logo").attr("src",t.site2+e.data.logo),$("#user-infos-group>.user-infos>h5").html(e.data.uname).next().html(e.data.ptime),$("#heart-single-group>.heart:eq(0)").html("<p>"+e.data.smile+"</p>").next().html("<p>"+e.data.lefteye+"</p>").next().html("<p>"+e.data.age+"</p>").next().html("<p>"+e.data.mouth+"</p>").next().html("<p>"+e.data.righteye+"</p>").next().html("<p>"+e.data.emotion+"</p>").next().html(e.data.gender),$(".stamp-front>h3").html(e.data.score+"分"),$(".envelope-comments").html(e.data.comment),$("#gift-modal .gift-panel-input>input").attr("max",e.data.pignunber),$("#user>.user-infos>.user-detail>p:eq(0)").html(e.data.uname).next().html(e.data.ptime),$(".heart-score").show().children("span").html(e.data.score-0+(e.data.poll-0)+"分"),$("#comments-list").css("margin-top","-.5rem"),$("#module-envelope").css("bottom","1.4rem")):alert(e.msg)}):window.location.href="/404.html"},getList:function(e){var s=this,t=s.getQueryString(e);t?s.getAjax("/FrontendService.asmx/AppearanceShowCommonList?",{id:t},function(e){if(console.log(e),1==e.msgcode){var a=e.data.list;if(0==a.length)$("#comments-list").hide(),$("#comments-list.comments-none").show();else{var o="",n="";a.forEach(function(i,e,t){0<a[e].rlist.length?a[e].rlist.forEach(function(e,t,a){n+='<div class="rcomments-item" data-id='+i.id+'><div class="comments-top"  data-uid='+e.fuid+'><img src="'+s.site2+e.fulogo+'" alt="" class="avatar"><div class="commenter-name">'+e.funame+'</div><span>回复</span></div><div class="comment-content" data-id='+e.tuid+" >@"+e.tuname+"&nbsp;"+e.fcontent+"</div></div>"}):n="",o+='<li class="comments-item" data-id='+i.id+'><div class="comments-top" data-uid='+i.uid+'><img src="'+s.site2+i.ulogo+'" alt="" class="avatar"><div class="commenter-name">'+i.uname+'</div><span>回复</span></div><div class="comment-content">'+i.content+"</div>"+n+"</li>",$("#comments-list").html(o)})}}else alert(e.msg)}):window.location.href="/404.html"},getList1:function(e){var s=this,t=s.getQueryString(e);t?s.getAjax("/FrontendService.asmx/AppearanceLevelCommonList?",{id:t},function(e){if(1==e.msgcode){var a=e.data.list;if(0<a.length){var o="",n="";a.forEach(function(i,e,t){0<a[e].rlist.length?a[e].rlist.forEach(function(e,t,a){n+='<div class="rcomments-item" data-id='+i.id+'><div class="comments-top"  data-uid='+e.fuid+'><img src="'+s.site2+e.fulogo+'" alt="" class="avatar"><div class="commenter-name">'+e.funame+'</div><span>回复</span></div><div class="comment-content" data-id='+e.tuid+">@"+e.tuname+"&nbsp;"+e.fcontent+"</div></div>"}):n="",o+='<li class="comments-item" data-id='+i.id+'><div class="comments-top" data-uid='+i.uid+'><img src="'+s.site2+i.ulogo+'" alt="" class="avatar"><div class="commenter-name">'+i.uname+'</div><span>回复</span></div><div class="comment-content">'+i.content+"</div>"+n+"</li>",$("#comments-list").html(o)})}else $("#comments-list").hide(),$("#comments-list.comments-none").show()}else alert(e.msg)}):window.location.href="/404.html"},share:function(){if(r.isClient){var e=r.getQueryString("acc"),t=window.location.href,a=t.indexOf("acc");if("&"==t.charAt(a-1))var i="&acc="+e;else if("?"==t.charAt(a-1))i="acc="+e+"&";var o={title:r.shareData.title,subTitle:r.shareData.subTitle,shareUrl:t.replace(i,"")};WebViewJavascriptBridge.callHandler("skipCategoryOfShare",o,function(e){})}else if(browser.versions.mobile){var n=navigator.userAgent.toLowerCase();"micromessenger"==n.match(/MicroMessenger/i)||"qq"==n.match(/QQ/i)?confirm("您当前使用的是qq/微信，无法参与本次活动，确认下载app？参与到孤独活动中来?")&&(location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.ruanmeng.gexiazi"):(browser.versions.ios||browser.versions.android)&&confirm("您当前使用的是浏览器，无法参与本次活动，确认下载app？参与到孤独活动中来?")&&(location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.ruanmeng.gexiazi"),"weibo"==n.match(/WeiBo/i)&&confirm("您当前使用的是新浪，无法参与本次活动，确认下载app？参与到孤独活动中来?")&&(location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.ruanmeng.gexiazi")}},downloadApp:function(){if(browser.versions.mobile){var e=navigator.userAgent.toLowerCase();"micromessenger"==e.match(/MicroMessenger/i)||"qq"==e.match(/QQ/i)?confirm("您当前使用的是qq/微信，无法参与本次活动，确认下载app？参与到魔镜活动中来?")&&(location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.ruanmeng.gexiazi"):(browser.versions.ios||browser.versions.android)&&confirm("您当前使用的是浏览器，无法参与本次活动，确认下载app？参与到魔镜活动中来?")&&(location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.ruanmeng.gexiazi"),"weibo"==e.match(/WeiBo/i)&&confirm("您当前使用的是新浪，无法参与本次活动，确认下载app？参与到魔镜活动中来?")&&(location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.ruanmeng.gexiazi")}else confirm("您当前使用的是PC端页面，无法参与本次活动，确认下载app？参与到魔镜活动中来?")&&(location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.ruanmeng.gexiazi")},submitForm:function(t,e){var a=t.val(),i=this,o="";e.parent().remove(),a?a.length<5?($("#form-tips").text("不能低于五个字呦!").fadeIn(),setTimeout(function(){t.val(""),$("#form-tips").text("").fadeOut()},1e3)):(o=1==i.type?"/ClientService.asmx/UserReviewAppearanceShow":"/ClientService.asmx/UserReviewAppearanceLevel",i.postAjax(o,{id:i.getQueryString("id"),reviewid:i.reviewid,reviewuserid:i.reviewuserid,content:a},function(e){1==e.msgcode?($("#form-tips").text(e.msg).fadeIn(),$(".comments-list").html(""),1==i.type?i.getList("id"):i.getList1("id")):$("#form-tips").text(e.msg).fadeIn(),setTimeout(function(){t.val(""),$("#form-tips").text("").fadeOut()},1e3)})):($("#form-tips").text("不能什么都不说啊!").fadeIn(),setTimeout(function(){t.val(""),$("#form-tips").text("").fadeOut()},1e3))},isLogin:function(){return!!sessionStorage.getItem("login")},submitOnTop:function(){var t=this,e=t.isLogin(),a=$("#comments").val();if(a.length)if(e){if(1==t.type)var i="/ClientService.asmx/UserReviewAppearanceShow";else i="/ClientService.asmx/UserReviewAppearanceLevel";t.postAjax(i,{id:t.id,reviewid:0,reviewuserid:0,content:a},function(e){1==e.msgcode?($("#form-tips").text(e.msg).fadeIn(),$("#comments").val(""),$(".comments-list").html(""),1==t.type?t.getList("id"):t.getList1("id")):$("#form-tips").text(e.msg).fadeIn()})}else window.sessionStorage.setItem("url",window.location),window.location.href="logReg.html?"+window.location;else $("#form-tips").text("您还什么都没有写呢").fadeIn();setTimeout(function(){$("#form-tips").fadeOut(1e3)},1e3)},setReplyForm:function(e){if(this.isLogin()){$(".reply-area").each(function(){e.remove()}),r.reviewid=e.parents(".comments-item").attr("data-id"),r.reviewuserid=e.parent().attr("data-uid");var t=r.replyHtml;e.parent().next().after(t)}else window.sessionStorage.setItem("url",window.location),window.location.href="logReg.html?"+window.location},voteForHim:function(e){var t=this;t.isLogin()?(t.postAjax("/ClientService.asmx/HelpHimOnTheList",{id:t.id},function(e){1==e.msgcode?($("#form-tips").text(e.msg).fadeIn(),ele.hide().next().next().next().show(),t.Info.isvote,$(".comments-list").html(""),1==t.type?(console.log(1==t.type),t.getList("id")):t.getList1("id")):$("#form-tips").text(e.msg).fadeIn()}),setTimeout(function(){$("#form-tips").fadeOut(1e3)},1e3)):(window.sessionStorage.setItem("url",window.location),window.location.href="logReg.html?"+window.location)},openGiftsModal:function(){var e=this.isLogin(),t=this.Info.pignunber;e?t?(this.giftFresh(),$("#gift-modal").fadeIn()):$("#no-gift-modal").fadeIn():(window.sessionStorage.setItem("url",window.location),window.location.href="logReg.html?"+window.location)},giftFresh:function(){var e=this.Info.pignunber,t=parseInt(Math.random()*e)+1,a=t.toString().length;console.log(t),0==t?this.giftFresh():(this.Info.reduceNum=t,$("#gift-number").val(t).css({width:.5*a+"rem"}))},inputGiftNumber:function(e){this.Info.pignunber;var t=$.trim(e.val()),a=t.toString().length;(this.Info.reduceNum=t)<=0?e.val(1):$("#gift-modal .gift-panel-input").css({width:.5*a+"rem"})},focusRemark:function(e){e.hide(),e.next().show()},sendGiftsForHim:function(){var t=this;if(t.isLogin())if(t.Info.reduceNum>t.Info.pignunber)$("#form-tips").text("您只有"+t.Info.pignunber+"个金猪").fadeIn(),setTimeout(function(){$("#form-tips").fadeOut()},1e3);else if(0==t.Info.pignunber)$("#no-gift-modal").fadeIn();else{var e=$("#gift-panel-message").val();t.postAjax("/ClientService.asmx/UserGiveGoldenPig",{id:t.id,pn:t.Info.reduceNum,remark:e||""},function(e){1==e.msgcode?($("#form-tips").text(e.msg).fadeIn(),$(".comments-list").html(""),t.Info.pignunber=t.Info.pignunber-t.Info.reduceNum):$("#form-tips").text(e.msg).fadeIn()}),setTimeout(function(){$("#form-tips").fadeOut(),t.closeGiftModal()},1e3)}else window.sessionStorage.setItem("url",window.location),window.location.href="logReg.html?"+window.location},closeGiftModal:function(){this.Info.pignunber?($("#gift-modal").fadeOut(),$("#gift-modal .gift-panel-message label").show(),$("#gift-modal .gift-panel-message label").next().hide()):$("#no-gift-modal").fadeOut()},init:function(){this.getDetail("id")}}).init()});
//# sourceMappingURL=index.js.map
